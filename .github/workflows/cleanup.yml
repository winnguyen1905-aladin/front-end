name: Cleanup Old Artifacts

on:
  schedule:
    # Cháº¡y má»—i ngÃ y lÃºc 2:00 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  cleanup:
    name: Clean Docker Images & Artifacts
    runs-on: self-hosted
    
    steps:
      - name: Remove unused Docker images
        run: |
          echo "ðŸ§¹ Cleaning up Docker images..."
          docker image prune -a -f --filter "until=168h"  # XÃ³a images cÅ© hÆ¡n 7 ngÃ y
          echo "âœ… Docker cleanup completed"

      - name: Remove dangling images
        run: |
          docker image prune -f
          echo "âœ… Dangling images removed"

      - name: Show Docker disk usage
        run: |
          echo "ðŸ“Š Current Docker disk usage:"
          docker system df

      - name: Clean npm cache (if needed)
        run: |
          echo "ðŸ§¹ Cleaning npm cache..."
          npm cache verify
        continue-on-error: true

      - name: Summary
        run: |
          echo "âœ… Cleanup job completed!"
          echo "ðŸ“Š Docker status:"
          docker ps -a

